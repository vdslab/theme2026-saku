# Product Context: トーラス階層割当システム

## なぜこのプロジェクトが存在するのか

階層グラフ（Hierarchical Graph）の可視化において、すべてのノードがサイクルに含まれる場合、従来の階層割当手法では対応できない。トーラス構造を用いることで、サイクルを含むグラフを階層的に表現できるようにする。

## 解決する問題

### 主要な課題

1. **サイクルを含むグラフの階層表現**: 従来のDAG前提の階層割当では、サイクルを含むグラフを扱えない
2. **トーラス辺の最小化**: 不必要なトーラス辺を増やすと可読性が低下
3. **階層数の決定**: 手動での階層数設定は試行錯誤が必要

### 解決方法

- **数理最適化**: Gurobiを用いた整数計画法により厳密解を保証
- **Big-M法**: トーラス辺を自動判定する技術
- **多目的最適化**: 階層数、エッジスパン、トーラス辺数を同時に最適化

## ユーザー体験の目標

### 入力

```python
V = [0, 1, 2]  # ノード集合
A = [(0, 1), (1, 2), (2, 0)]  # エッジ集合（サイクル）
y_val, t_val, L = torus(V, A)
```

### 出力

- 各ノードの最適な階層割当
- トーラス辺の識別
- レイヤー集合（描画用）

### 期待される結果

- **DAG**: トーラス辺なしで自然な階層構造
- **サイクリックグラフ**: 必要最小限のトーラス辺で階層表現
- **視覚化**: トーラス辺を視覚的に区別して表示

## どのように動作すべきか

### ワークフロー

1. グラフデータ（V, A）を入力
2. 数理最適化で階層を計算
3. トーラス辺を自動判定
4. 結果を可視化

### 重要な振る舞い

- **透明性**: 最適化の結果（階層数、トーラス辺数、目的関数値）を出力
- **柔軟性**: パラメータ（α, β, γ）でトレードオフを調整可能
- **ロバスト性**: エッジの重複を自動除去、エラー時はIIS（実行不可能制約集合）を表示
